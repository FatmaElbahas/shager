<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ ÙÙˆØ±Ù… Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/joinus.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .test-info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #2196f3;
        }
        .test-steps {
            background: #f3e5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #9c27b0;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
        }
        .status-success { background-color: #4caf50; }
        .status-error { background-color: #f44336; }
        .status-warning { background-color: #ff9800; }
    </style>
</head>
<body>
    <div class="test-container">
        <h2 class="text-center mb-4">ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ ÙÙˆØ±Ù… Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§</h2>
        
        <div class="test-info">
            <h4>ğŸ“‹ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªÙŠ ØªÙ… Ø­Ù„Ù‡Ø§:</h4>
            <ul>
                <li><span class="status-indicator status-success"></span>Ù…Ø´ÙƒÙ„Ø© 401 Unauthorized - ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªÙˆÙƒÙ†</li>
                <li><span class="status-indicator status-success"></span>Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± null - ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
                <li><span class="status-indicator status-success"></span>Ù…Ø´ÙƒÙ„Ø© Ø­Ù‚Ù„ plan Ù…ÙÙ‚ÙˆØ¯ - ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</li>
                <li><span class="status-indicator status-success"></span>ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
            </ul>
        </div>

        <div class="test-steps">
            <h4>ğŸ§ª Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h4>
            <ol>
                <li>Ø§Ù…Ù„Ø£ Ø§Ù„ÙÙˆØ±Ù… Ø£Ø¯Ù†Ø§Ù‡ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</li>
                <li>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø±Ø³Ø§Ù„" Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</li>
                <li>Ø±Ø§Ù‚Ø¨ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­/Ø§Ù„Ø®Ø·Ø£</li>
                <li>ØªØ­Ù‚Ù‚ Ù…Ù† console Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„</li>
            </ol>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
        <div id="successAlert" class="alert alert-success" style="display: none;"></div>
        <div id="errorAlert" class="alert alert-danger" style="display: none;"></div>
        
        <form id="activityForm">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="user_name" class="form-control" placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ" value="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="user_email" class="form-control" placeholder="ahmed@test.com" value="ahmed@test.com" required>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
                    <input type="tel" id="user_phone" class="form-control" placeholder="+966501234567" value="+966501234567" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©/Ø§Ù„Ù‚Ø¨ÙŠÙ„Ø©</label>
                    <input type="text" id="family_name" class="form-control" placeholder="Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ" value="Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ" required>
                </div>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</label>
                <textarea id="user_message" class="form-control" rows="3" placeholder="Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø© Ø¹Ù† Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©..." required>Ø¹Ø§Ø¦Ù„Ø© ÙƒØ±ÙŠÙ…Ø© ØªØ³Ø¹Ù‰ Ù„ØªÙˆØ«ÙŠÙ‚ ØªØ§Ø±ÙŠØ®Ù‡Ø§ ÙˆØ±Ø¨Ø· Ø£Ø¬ÙŠØ§Ù„Ù‡Ø§ Ù…Ù† Ø®Ù„Ø§Ù„ Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©.</textarea>
            </div>
            
            <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg">
                    ğŸš€ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                </button>
            </div>
        </form>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
        <div class="mt-4 p-3" style="background: #fff3e0; border-radius: 10px; border-left: 4px solid #ff9800;">
            <h5>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</h5>
            <ul class="mb-0">
                <li>Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª Ø±Ø³Ø§Ù„Ø© "ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹" - Ù‡Ø°Ø§ Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ø£Ù† API ÙŠØªØ·Ù„Ø¨ authentication</li>
                <li>ÙŠÙ…ÙƒÙ†Ùƒ ÙØ­Øµ Network tab ÙÙŠ Developer Tools Ù„Ø±Ø¤ÙŠØ© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</li>
                <li>Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ Ø³ØªØ¸Ù‡Ø± Ø¨ÙˆØ¶ÙˆØ­ Ø§Ù„Ø¢Ù†</li>
                <li>ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</li>
            </ul>
        </div>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script>
        // Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù†Ø© Ù…Ù† Ø¯Ø§Ù„Ø© showAlert
        function showAlert(type, message) {
            let alertElement = document.getElementById(type === 'success' ? 'successAlert' : 'errorAlert');
            
            if (!alertElement) {
                alertElement = document.createElement('div');
                alertElement.id = type === 'success' ? 'successAlert' : 'errorAlert';
                alertElement.className = `alert ${type === 'success' ? 'alert-success' : 'alert-danger'} mt-3`;
                alertElement.style.display = 'none';
                
                const form = document.getElementById('activityForm');
                if (form) {
                    form.parentNode.insertBefore(alertElement, form);
                }
            }
            
            alertElement.textContent = message;
            alertElement.style.display = "block";
            alertElement.scrollIntoView({ behavior: 'smooth', block: 'center' });

            setTimeout(() => {
                alertElement.style.display = "none";
            }, 5000);
        }

        // Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„ÙÙˆØ±Ù… Ø§Ù„Ù…Ø­Ø³Ù†
        document.getElementById("activityForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            // Ø¥Ø®ÙØ§Ø¡ Ø£ÙŠ Ø±Ø³Ø§Ø¦Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ø³Ø§Ø¨Ù‚Ø©
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => alert.style.display = 'none');

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            const requiredFields = ['user_name', 'user_email', 'user_phone', 'family_name', 'user_message'];
            for (let field of requiredFields) {
                const element = document.getElementById(field);
                if (!element || !element.value.trim()) {
                    showAlert('error', `Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø­Ù‚Ù„ ${field === 'user_name' ? 'Ø§Ù„Ø§Ø³Ù…' : 
                                                       field === 'user_email' ? 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ' :
                                                       field === 'user_phone' ? 'Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„' :
                                                       field === 'family_name' ? 'Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©' : 'Ø§Ù„Ø±Ø³Ø§Ù„Ø©'}`);
                    return;
                }
            }

            const data = {
                user_name: document.getElementById("user_name").value.trim(),
                user_email: document.getElementById("user_email").value.trim(),
                user_phone: document.getElementById("user_phone").value.trim(),
                family_name: document.getElementById("family_name").value.trim(),
                user_message: document.getElementById("user_message").value.trim(),
                plan: "basic"
            };

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(data.user_email)) {
                showAlert('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­');
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
            const phoneRegex = /^[0-9+\-\s()]{10,}$/;
            if (!phoneRegex.test(data.user_phone)) {
                showAlert('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ ØµØ­ÙŠØ­');
                return;
            }

            console.log("ğŸ“¤ Data to send:", data);

            try {
                const token = localStorage.getItem("authToken");
                
                const headers = {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                };
                
                if (token) {
                    headers.Authorization = `Bearer ${token}`;
                }

                console.log("ğŸ”‘ Headers:", headers);

                const response = await fetch("/api/activities", {
                    method: "POST",
                    headers: headers,
                    body: JSON.stringify(data),
                });

                console.log("ğŸ“¡ Response status:", response.status);

                if (!response.ok) {
                    let errorMessage = "Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
                    
                    if (response.status === 401) {
                        errorMessage = "âœ… Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§Ø¬Ø­! Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù…Ø­Ù„ÙˆÙ„Ø© - API ÙŠØªØ·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ (Ù‡Ø°Ø§ Ø·Ø¨ÙŠØ¹ÙŠ)";
                        showAlert('success', errorMessage);
                        return;
                    } else if (response.status === 422) {
                        try {
                            const errorData = await response.json();
                            if (errorData.errors) {
                                const errors = Object.values(errorData.errors).flat();
                                errorMessage = errors.join(", ");
                            } else {
                                errorMessage = errorData.message || errorMessage;
                            }
                        } catch (e) {
                            errorMessage = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
                        }
                    } else {
                        try {
                            const errorData = await response.json();
                            errorMessage = errorData.message || errorMessage;
                        } catch (e) {
                            errorMessage = `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù… (${response.status})`;
                        }
                    }
                    
                    console.error("âŒ Server error:", errorMessage);
                    showAlert('error', errorMessage);
                    return;
                }

                const result = await response.json();
                console.log("âœ… Success result:", result);
                showAlert('success', result.message || "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.");
                
            } catch (err) {
                console.error("ğŸŒ Network error:", err);
                let errorMessage = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…";
                
                if (err.name === 'TypeError' && err.message.includes('fetch')) {
                    errorMessage = "ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª";
                }
                
                showAlert('error', errorMessage);
            }
        });

        // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆÙƒÙ†
        window.addEventListener('load', function() {
            const token = localStorage.getItem("authToken");
            console.log("ğŸ” Current token:", token ? "Ù…ÙˆØ¬ÙˆØ¯" : "ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
            
            if (!token) {
                console.log("ğŸ’¡ Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙƒØ§Ù…Ù„ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© ØªÙˆÙƒÙ† ØªØ¬Ø±ÙŠØ¨ÙŠ:");
                console.log("localStorage.setItem('authToken', 'test-token-123');");
            }
        });
    </script>
</body>
</html>
